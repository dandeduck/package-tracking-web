{%extends 'base.html' %}

{% block main_block %}
    <h2> Order {{order.collection_date.date}} </h2>
    <ul>
        {%for package in packages%}
            <li>
                {{package.full_name}} {{package.origin.city}}, {{package.origin.street_name}} -> {{package.destination}} {{package.status}} ({%include "financials/calc_rate.html" %}₪) <a href="/partners/{{partner.name}}/{{order.id}}/{{package.id}}/"> edit </a>
            </li>
        {%endfor%}
    </ul>

    <button onclick="javascript:toggle_creation()" id="show_creation">add</button>
    <div class="creation" id="creation" style="display: none;">
        <form method="post" name="create" id="create"> {% csrf_token %}
            <div class="creation--left">
                <label>Origin</label>
                <input type="text" placeholder="Street" name="origin_street" value="{{partner.address.street_name}}"/>
                <input type="number" placeholder="House Number" name="origin_street_number" value="{{partner.address.street_number}}"/>
                <input type="text" placeholder="City" name="origin_city" list="cities" value="{{partner.address.city.name}}"/>
                <select name="origin_area" class="area__select sla1" form="create">
                    {%for db, human in cities.0.AREA_CHOICES%}
                        {%if db == partner.address.city.area%}
                            <option>{{human}}</option>
                        {%endif%}
                    {%endfor%}
                    {%for db, human in cities.0.AREA_CHOICES%}
                        {%if db != partner.address.city.area%}
                            <option>{{human}}</option>
                        {%endif%}
                    {%endfor%}
                </select>
            </div>
            <div class="creation--center">
                <label>Destination</label>
                <input type="text" placeholder="Street" name="destination_street"/>
                <input type="number" placeholder="House Number" value="0" name="destination_street_number"/>
                <input type="text" placeholder="City" name="destination_city" list="cities"/>
                <select name="destination_area" class="area__select sla2" form="create">
                    {%for db, human in cities.0.AREA_CHOICES%}
                        <option>{{human}}</option>
                    {%endfor%}
                </select>
            </div>
            <div class="creation--right">
                <label for="rates">Base package price</label>
                <select name="rate" class="rate__select slr" form="create" id="rates">
                    {%for rate in rates%}
                        <option>{{rate|floatformat}}₪</option>
                    {%endfor%}
                </select>
                <p>Optional</p>
                <input type="text" placeholder="Full name" name="full_name" list="names"/>
                <input type="tel" placeholder="Cell number" name="phone_number"/>
            </div>
            <div class="creation--bottom">
                <button onclick="javascript:toggle_creation()">add</button>
            </div>
        </form>
        <div class="creation--bottom">
            <button onclick="javascript:hide_form()">cancel</button>
        </div>
    </div>
    <div class="nav--bottom">
        <a href="/partners/{{partner.name}}/">ALL ORDERS</a>
        <a href="/notify/?p={{partner}}&next=/partners/{{partner}}">SAVE</a>
    </div>
    <datalist id="cities">
        {%include "packages/parts/list_options.html" with list=cities%}
    </datalist>
    <datalist id="streets">
        {%include "packages/parts/list_options.html" with list=streets%}
    </datalist>
    <datalist id="names">
        {%include "packages/parts/list_options.html" with list=names%}
    </datalist>
    <script type="text/javascript">
        function toggle_creation() {
            if(show_creation.style.display === "none") {
                document.forms[0].submit();
                hide_form();
            }
            else {
                show_form();
            }
        }

        function show_form() {
            var creation = document.getElementById("creation");
            var show_creation = document.getElementById("show_creation");

            show_creation.style.display = "none";
            creation.style.display = "block";
        }

        function hide_form() {
            var creation = document.getElementById("creation");
            var show_creation = document.getElementById("show_creation");

            show_creation.style.display = "block";
            creation.style.display = "none";
        }
    </script>
{% endblock %}